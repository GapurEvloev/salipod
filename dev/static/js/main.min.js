$(document).ready(function () {
    svg4everybody({});

    // popup video start
    $('[data-fancybox]').fancybox({
        youtube : {
            controls : 0,
            showinfo : 0
        },
        vimeo : {
            color : 'f00'
        }
    });
    
    const modalVideo = $('.video__link--desktop');

    if ($(window).width() < 1024) {
        modalVideo.attr('href', '#mobileVideo');
    } else {
        modalVideo.attr('href', '#modalVideo');
    }

    $(window).resize(function() {
        if ($(window).width() < 1024) {
            modalVideo.attr('href', '#mobileVideo');
        } else {
            modalVideo.attr('href', '#modalVideo');
        }
    });
    // popup video end

    // функция кастомного input(type='file') 
    var fileInput  = document.querySelector( "#file" ),  
        button     = document.querySelector( ".reg-form__label--file" ),
        the_return = document.querySelector(".reg-form__file-return");
        
    button.addEventListener( "keydown", function( event ) {  
        if ( event.keyCode == 13 || event.keyCode == 32 ) {  
            fileInput.focus();  
        }  
    });
    button.addEventListener( "click", function( event ) {
        fileInput.focus();
        return false;
    });  
    fileInput.addEventListener( "change", function( event ) {  
        the_return.innerHTML = this.files[0].name;  
    }); 
    // функция кастомного input(type='file')  end

    // Валидация формы start
    validate();
    $('#inputName, #inputEmail, #file').change(validate);

    function validate(){
        if ($('#inputName').val().length   >   0   &&
            $('#inputEmail').val().length  >   0   &&
            $('#file').val().length    >   0) {
            $("#reg-btn").prop("disabled", false);
        }
        else {
            $("#reg-btn").prop("disabled", true);
        }
    }
    // Валидация формы start end

    // Обработка формы start
    $(function () {
        $('#form').submit(function (e) {
            event.preventDefault();
            var $form = $(this);
            // var data = $form.serialize()
            var formData = new FormData();
            var fileInput = $('input#file')[0];
            var file = fileInput.files[0];
            var email = $('#inputEmail').val()
            var name = $('#inputName').val()
            formData.append('file',file);
            formData.append('email',email);
            formData.append('name',name);
            // data.append( 'file', $('.reg-form__input--file').files[0] );
            var result_form = $('#result_form')
            $.ajax({
                type: 'POST',
                url: '/save_data/',
                processData: false,
                cache: false,
                contentType: false,
                dataType: "json",
                data: formData,
                success: function (response) { //Данные отправлены успешно
                    $.fancybox.open('<div class="success-message"><p>Ваши данные были успешно сохранены!</p></div>');
                },
                error: function (response) { // Данные не отправлены
                    console.log(formData)
                    result_form.html("Ошибка! Данные не отправленны.")
                    // $.fancybox.open('<div class="success-message"><p>Ошибка. Данные не отправленны.</p></div>');
    
                }
            })
            //отмена действия по умолчанию для кнопки submit
            return false;
        });
    });
    
    // Обработка формы end

});

// инициализация анимации
new WOW().init({
    scrollContainer: '.scroll'
});
// инициализация анимации конец
